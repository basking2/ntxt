<html>
<head>
  <script src="ntxt.js" type="text/javascript"></script>
  <script>

  var ntxtTree=null;
  var tagFilter = ''
  var textFilter = ''
  
  function printTree(n, element) {
    
    var html = ""
    
    n.rootBlock.walkText( 
      function(txt, depth, node) {
      
        if ( txt.length == 0 ) {
          return;
        }
        
        if (tagFilter.length > 0 && node.tags.join(',').indexOf(tagFilter) >= 0) {
          html += txt
        } else if (textFilter.length > 0 && txt.indexOf( textFilter ) >= 0) {
            html += txt
        } else if ( tagFilter.length == 0 && textFilter.length == 0 ) {
          html += txt
        }
        
      },
      function(depth, node) {
        html += '<div class="ntxt"  name="block_div_plus" '
                + 'style="display:none;z-index:'
                +   depth
                +   ';font-size:110%;font-style:italic;" '
                + '>+ '
                + node.text().substr(0, 20) + '...'
                + '</div>'
        html += '<div class="ntxt" name="block_div" '
                + 'title="Tags: '+node.tags.join(', ')+'" '
                + 'style="display:inline;z-index:'+depth+'" '
                +'">'
 
        html += '<pre class="ntxt">'
      },
      function(depth, node) {
        html += '</pre></div>'
      } )
      
    element.innerHTML = html
    
    var a = document.getElementsByName('block_div')
    for ( var i=0; i < a.length; i+=1 ) {
      if ( a[i].tagName == 'DIV' ) {
        a[i].addEventListener( 'click', toggleVisibility)
        a[i].id = "block_div_"+i
      }
    }
    var a = document.getElementsByName('block_div_plus')
    for ( var i=0; i < a.length; i+=1 ) {
      if ( a[i].tagName == 'DIV' ) {
        a[i].addEventListener( 'click', toggleVisibility)
        a[i].id = "block_div_"+i+"_plus"
      }
    }

  }
  
  function searchTags(){
    tagFilter = document.getElementById('searchTagsInput').value
    
    printTree(ntxtTree, document.getElementById('ntxtDiv'));
  }
  
  function searchText(){
    textFilter =  document.getElementById('searchTextInput').value
    
    printTree(ntxtTree, document.getElementById('ntxtDiv'));
  }
  
  function toggleVisibility(event) {
    event.stopPropagation()
    event.preventDefault()
    var e = event.currentTarget
    var e2
    
    // Using the event ID, choose the "other" div object. 
    if ( /_plus$/.test( e.id ) ) {
      e2 = document.getElementById(e.id.substr(0, e.id.length-5))
    } else {
      e2 = document.getElementById(e.id+"_plus")
    }
    

    if ( e.style.display == 'none' ) {
      e.style.display = 'inline'
      e2.style.display= 'none'
    } else {
      e.style.display = 'none'
      e2.style.display = 'inline'
    }
    
  }
  
  window.addEventListener('load', function(e) {
    ntxtTree = ntxt.fetchNtxt()
    
    printTree(ntxtTree, document.getElementById('ntxtDiv'));
    
    document.getElementById('searchTagsInput').focus()
    var tagHash = {}
    
    for( var i in ntxtTree.rootBlock.tags ) {
      tagHash[ntxtTree.rootBlock.tags[i]]=1
    }
    
    document.getElementById('allTags').innerHTML = Object.keys(tagHash)
                                                         .sort()
                                                         .join(', ')
  })
  
  </script>
  
  
  <style>
    .ntxt {
      margin: 0em;
      padding: 0em;
    }
    pre.ntxt {
      font-size: 95%;
      padding-left: 1em;
      border: 0px black solid;
      border-left: 2px #000080 solid;
      background: rgba(0,0,255,0.03);
    }
  </style>
  
  
</head>
<body>

Goto <a href="#end">End</a> <a name="top">&nbsp;</a>
<br>
Search Text: <input type='text' onKeyUp='searchText()' id='searchTextInput' />
<br>
Search Tags: <input type='text' onKeyUp='searchTags()' id='searchTagsInput' />
<br>

<div style="display:inline-block;">Tags:</div> 

<div style="font-family: monospace; display:inline-block;"   id='allTags'></div>

<div id='ntxtDiv'>
</div>

<a name="end">&nbsp;</a>
<a href="#top">Top</a>
</body>
</html>
