<html>
<head>
  <script src="ntxt.js" type="text/javascript"></script>
  <script>

  var ntxtTree=null;
  var tagFilter = ''
  var textFilter = ''
  
  function printTree(n, element) {
    
    var html = ""
    
    n.rootBlock.walkText( 
      function(txt, depth, node) {
      
        if ( txt.length == 0 ) {
          return;
        }
        
        if (tagFilter.length > 0 && node.tags.join(',').indexOf(tagFilter) >= 0) {
          html += txt
        } else if (textFilter.length > 0 && txt.indexOf( textFilter ) >= 0) {
            html += txt
        } else if ( tagFilter.length == 0 && textFilter.length == 0 ) {
          html += txt
        }
        
      },
      function(depth, node) {
        html += '<div class="ntxt" title="Tags: '+node.tags.join(', ')+'">'
        html += '<pre class="ntxt">'
      },
      function(depth, node) {
        html += '</pre></div>'
      } )
      
    element.innerHTML = html
  }
  
  function searchTags(){
    tagFilter = document.getElementById('searchTagsInput').value
    
    printTree(ntxtTree, document.getElementById('ntxtDiv'));
  }
  
  function searchText(){
    textFilter =  document.getElementById('searchTextInput').value
    
    printTree(ntxtTree, document.getElementById('ntxtDiv'));
  }
  
  window.onload = function(){
    ntxtTree = ntxt.fetchNtxt()
    
    printTree(ntxtTree, document.getElementById('ntxtDiv'));
    
    document.getElementById('searchTagsInput').focus()
    
    var tagHash = {}
    
    for( var i in ntxtTree.rootBlock.tags ) {
      tagHash[ntxtTree.rootBlock.tags[i]]=1
    }
    
    document.getElementById('allTags').innerHTML = Object.keys(tagHash)
                                                         .sort()
                                                         .join(', ')
  }
  </script>
  
  
  <style>
    .ntxt {
      margin: 0em;
      padding: 0em;
    }
    pre.ntxt {
      font-size: 95%;
      padding-left: 1em;
      border: 0px black solid;
      border-left: 2px #000080 solid;
      background: rgba(0,0,255,0.03);
    }
  </style>
  
  
</head>
<body>
Search Text: <input type='text' onKeyUp='searchText()' id='searchTextInput' />
<br>
Search Tags: <input type='text' onKeyUp='searchTags()' id='searchTagsInput' />
<div id='allTags'></div>
<div id='ntxtDiv'>
</div>

</body>
</html>
